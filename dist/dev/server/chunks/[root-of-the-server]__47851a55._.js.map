{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/nvq2309/clawd/mission-control-v2/my-app/src/lib/db.ts"],"sourcesContent":["// Simple JSON-based database for quick start\n// Will be replaced with SQLite once bindings work\n\nimport { writeFileSync, readFileSync, existsSync, mkdirSync } from 'fs';\nimport { join } from 'path';\nimport type {\n  Task,\n  Agent,\n  Session,\n  PlanningSession,\n  CreateTaskInput,\n  UpdateTaskInput,\n  CreateAgentInput,\n  UpdateAgentInput,\n  CreatePlanningSessionInput,\n  SubmitPlanningAnswersInput,\n  CreateSessionInput,\n} from '@/types';\n\n// Use absolute path to ensure consistency across API routes and dev server\nconst DB_DIR = '/home/nvq2309/clawd/mission-control-v2/my-app/database';\nconst DB_FILE = join(DB_DIR, 'data.json');\n\ninterface Database {\n  tasks: Task[];\n  agents: Agent[];\n  sessions: Session[];\n  planningSessions: PlanningSession[];\n}\n\nlet db: Database | null = null;\n\nfunction initDb(): Database {\n  if (db) return db;\n  \n  if (!existsSync(DB_DIR)) {\n    mkdirSync(DB_DIR, { recursive: true });\n  }\n  \n  if (existsSync(DB_FILE)) {\n    try {\n      const data = readFileSync(DB_FILE, 'utf-8');\n      db = JSON.parse(data);\n      return db!;\n    } catch {\n      // Fall through to create new\n    }\n  }\n  \n  db = {\n    tasks: [],\n    agents: [],\n    sessions: [],\n    planningSessions: [],\n  };\n  saveDb();\n  return db;\n}\n\nfunction saveDb() {\n  if (db) {\n    writeFileSync(DB_FILE, JSON.stringify(db, null, 2));\n  }\n}\n\nfunction getDb(): Database {\n  if (!db) return initDb();\n  return db;\n}\n\nexport function initDatabase(): Database {\n  return initDb();\n}\n\n// ============================================\n// TASK QUERIES\n// ============================================\n\nexport const TaskQueries = {\n  getAll(filters?: { status?: string; agent_id?: string; priority?: number }): Task[] {\n    const database = getDb();\n    let tasks = database.tasks;\n    \n    if (filters?.status) {\n      tasks = tasks.filter(t => t.status === filters.status);\n    }\n    if (filters?.agent_id) {\n      tasks = tasks.filter(t => t.agent_id === filters.agent_id);\n    }\n    if (filters?.priority !== undefined) {\n      tasks = tasks.filter(t => t.priority === filters.priority);\n    }\n    \n    return tasks.sort((a, b) => b.priority - a.priority);\n  },\n\n  getById(id: string): Task | null {\n    const database = getDb();\n    return database.tasks.find(t => t.id === id) || null;\n  },\n\n  create(input: CreateTaskInput & { id: string }): Task {\n    const database = getDb();\n    const task: Task = {\n      id: input.id,\n      title: input.title,\n      description: input.description || null,\n      status: 'pending',\n      priority: input.priority || 5,\n      agent_id: null,\n      deliverables: [],\n      planning_session_id: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      started_at: null,\n      completed_at: null,\n    };\n    database.tasks.push(task);\n    saveDb();\n    return task;\n  },\n\n  update(id: string, input: UpdateTaskInput): Task | null {\n    const database = getDb();\n    const idx = database.tasks.findIndex(t => t.id === id);\n    if (idx === -1) return null;\n    \n    const task = database.tasks[idx];\n    database.tasks[idx] = {\n      ...task,\n      title: input.title ?? task.title,\n      description: input.description !== undefined ? input.description : task.description,\n      status: input.status ?? task.status,\n      priority: input.priority ?? task.priority,\n      agent_id: input.agent_id !== undefined ? input.agent_id : task.agent_id,\n      deliverables: input.deliverables ?? task.deliverables,\n      updated_at: new Date().toISOString(),\n    };\n    saveDb();\n    return database.tasks[idx];\n  },\n\n  delete(id: string): boolean {\n    const database = getDb();\n    const idx = database.tasks.findIndex(t => t.id === id);\n    if (idx === -1) return false;\n    database.tasks.splice(idx, 1);\n    saveDb();\n    return true;\n  },\n\n  linkPlanningSession(taskId: string, planningSessionId: string): boolean {\n    return !!this.update(taskId, { planning_session_id: planningSessionId, status: 'planning' });\n  },\n\n  updateStatus(id: string, status: string): Task | null {\n    const updates: Partial<Task> = { status: status as Task['status'] };\n    if (status === 'in_progress') {\n      updates.started_at = new Date().toISOString();\n    } else if (status === 'completed' || status === 'failed') {\n      updates.completed_at = new Date().toISOString();\n    }\n    return this.update(id, updates);\n  },\n};\n\n// ============================================\n// AGENT QUERIES\n// ============================================\n\nexport const AgentQueries = {\n  getAll(): Agent[] {\n    return getDb().agents;\n  },\n\n  getById(id: string): Agent | null {\n    return getDb().agents.find(a => a.id === id) || null;\n  },\n\n  create(input: CreateAgentInput & { id: string }): Agent {\n    const database = getDb();\n    const agent: Agent = {\n      id: input.id,\n      name: input.name,\n      role: input.role,\n      status: 'idle',\n      current_task_id: null,\n      session_key: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n    database.agents.push(agent);\n    saveDb();\n    return agent;\n  },\n\n  update(id: string, input: UpdateAgentInput): Agent | null {\n    const database = getDb();\n    const idx = database.agents.findIndex(a => a.id === id);\n    if (idx === -1) return null;\n    \n    const agent = database.agents[idx];\n    database.agents[idx] = {\n      ...agent,\n      name: input.name ?? agent.name,\n      role: input.role ?? agent.role,\n      status: input.status ?? agent.status,\n      current_task_id: input.current_task_id !== undefined ? input.current_task_id : agent.current_task_id,\n      session_key: input.session_key !== undefined ? input.session_key : agent.session_key,\n      updated_at: new Date().toISOString(),\n    };\n    saveDb();\n    return database.agents[idx];\n  },\n\n  getIdle(): Agent[] {\n    return getDb().agents.filter(a => a.status === 'idle');\n  },\n\n  assignTask(agentId: string, taskId: string): boolean {\n    return !!this.update(agentId, { status: 'busy', current_task_id: taskId });\n  },\n\n  clearTask(agentId: string): boolean {\n    return !!this.update(agentId, { status: 'idle', current_task_id: null });\n  },\n};\n\n// ============================================\n// PLANNING SESSION QUERIES\n// ============================================\n\nexport const PlanningSessionQueries = {\n  getAll(): PlanningSession[] {\n    return getDb().planningSessions;\n  },\n\n  getById(id: string): PlanningSession | null {\n    return getDb().planningSessions.find(p => p.id === id) || null;\n  },\n\n  getByTaskId(taskId: string): PlanningSession | null {\n    return getDb().planningSessions.find(p => p.task_id === taskId) || null;\n  },\n\n  create(input: CreatePlanningSessionInput & { id: string; taskId: string }): PlanningSession {\n    const database = getDb();\n    const session: PlanningSession = {\n      id: input.id,\n      task_id: input.taskId,\n      questions: input.questions,\n      answers: [],\n      completed: false,\n      created_at: new Date().toISOString(),\n      completed_at: null,\n    };\n    database.planningSessions.push(session);\n    saveDb();\n    return session;\n  },\n\n  submitAnswers(id: string, input: SubmitPlanningAnswersInput): PlanningSession | null {\n    const database = getDb();\n    const idx = database.planningSessions.findIndex(p => p.id === id);\n    if (idx === -1) return null;\n    \n    const session = database.planningSessions[idx];\n    const updatedAnswers = [...session.answers, ...input.answers];\n    const allAnswered = updatedAnswers.length >= session.questions.length;\n    \n    database.planningSessions[idx] = {\n      ...session,\n      answers: updatedAnswers,\n      completed: allAnswered,\n      completed_at: allAnswered ? new Date().toISOString() : null,\n    };\n    saveDb();\n    return database.planningSessions[idx];\n  },\n\n  delete(id: string): boolean {\n    const database = getDb();\n    const idx = database.planningSessions.findIndex(p => p.id === id);\n    if (idx === -1) return false;\n    database.planningSessions.splice(idx, 1);\n    saveDb();\n    return true;\n  },\n};\n\n// ============================================\n// SESSION QUERIES\n// ============================================\n\nexport const SessionQueries = {\n  getAll(): Session[] {\n    return getDb().sessions;\n  },\n\n  getById(id: string): Session | null {\n    return getDb().sessions.find(s => s.id === id) || null;\n  },\n\n  getByAgentId(agentId: string): Session[] {\n    return getDb().sessions.filter(s => s.agent_id === agentId);\n  },\n\n  getByTaskId(taskId: string): Session[] {\n    return getDb().sessions.filter(s => s.task_id === taskId);\n  },\n\n  create(input: CreateSessionInput & { id: string }): Session {\n    const database = getDb();\n    const session: Session = {\n      id: input.id,\n      agent_id: input.agent_id,\n      task_id: input.task_id,\n      status: 'active',\n      output: null,\n      error_message: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      completed_at: null,\n    };\n    database.sessions.push(session);\n    saveDb();\n    return session;\n  },\n\n  appendOutput(id: string, output: string): boolean {\n    const database = getDb();\n    const idx = database.sessions.findIndex(s => s.id === id);\n    if (idx === -1) return false;\n    database.sessions[idx].output = (database.sessions[idx].output || '') + output;\n    database.sessions[idx].updated_at = new Date().toISOString();\n    saveDb();\n    return true;\n  },\n\n  updateStatus(id: string, status: string): boolean {\n    const database = getDb();\n    const idx = database.sessions.findIndex(s => s.id === id);\n    if (idx === -1) return false;\n    database.sessions[idx].status = status as Session['status'];\n    database.sessions[idx].updated_at = new Date().toISOString();\n    saveDb();\n    return true;\n  },\n\n  complete(id: string, errorMessage?: string): Session | null {\n    const database = getDb();\n    const idx = database.sessions.findIndex(s => s.id === id);\n    if (idx === -1) return null;\n    database.sessions[idx].status = errorMessage ? 'failed' : 'completed';\n    database.sessions[idx].error_message = errorMessage || null;\n    database.sessions[idx].completed_at = new Date().toISOString();\n    database.sessions[idx].updated_at = new Date().toISOString();\n    saveDb();\n    return database.sessions[idx];\n  },\n\n  cancel(id: string): Session | null {\n    return this.complete(id, 'cancelled');\n  },\n};\n\nexport function closeDatabase(): void {\n  db = null;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 387, "column": 0}, "map": {"version":3,"sources":["file:///home/nvq2309/clawd/mission-control-v2/my-app/src/app/api/agents/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { v4 as uuidv4 } from 'uuid';\nimport { z } from 'zod';\nimport { AgentQueries, initDatabase } from '@/lib/db';\nimport type { ApiResponse, AgentListResponse, CreateAgentInput, Agent } from '@/types';\n\n// Initialize database\ninitDatabase();\n\n// Validation schemas\nconst createAgentSchema = z.object({\n  name: z.string().min(1).max(255),\n  role: z.string().min(1).max(255),\n});\n\n/**\n * GET /api/agents - List all agents\n */\nexport async function GET(request: NextRequest): Promise<NextResponse> {\n  try {\n    const { searchParams } = new URL(request.url);\n    const status = searchParams.get('status') || undefined;\n\n    let agents = AgentQueries.getAll();\n    \n    // Filter by status if provided\n    if (status) {\n      agents = agents.filter(a => a.status === status);\n    }\n\n    const response: ApiResponse<AgentListResponse> = {\n      success: true,\n      data: {\n        agents,\n        total: agents.length,\n      },\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Error fetching agents:', error);\n    const response: ApiResponse<never> = {\n      success: false,\n      error: 'Failed to fetch agents',\n    };\n    return NextResponse.json(response, { status: 500 });\n  }\n}\n\n/**\n * POST /api/agents - Create a new agent\n */\nexport async function POST(request: NextRequest): Promise<NextResponse> {\n  try {\n    const body = await request.json();\n    \n    // Validate input\n    const validation = createAgentSchema.safeParse(body);\n    if (!validation.success) {\n      const response: ApiResponse<never> = {\n        success: false,\n        error: 'Invalid input: ' + validation.error.issues.map(e => e.message).join(', '),\n      };\n      return NextResponse.json(response, { status: 400 });\n    }\n\n    const input: CreateAgentInput = validation.data;\n    const agent = AgentQueries.create({\n      ...input,\n      id: uuidv4(),\n    });\n\n    const response: ApiResponse<Agent> = {\n      success: true,\n      data: agent,\n      message: 'Agent created successfully',\n    };\n\n    return NextResponse.json(response, { status: 201 });\n  } catch (error) {\n    console.error('Error creating agent:', error);\n    const response: ApiResponse<never> = {\n      success: false,\n      error: 'Failed to create agent',\n    };\n    return NextResponse.json(response, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAGA,sBAAsB;AACtB,IAAA,kIAAY;AAEZ,qBAAqB;AACrB,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACjC,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;IAC5B,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AAC9B;AAKO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAE7C,IAAI,SAAS,kIAAY,CAAC,MAAM;QAEhC,+BAA+B;QAC/B,IAAI,QAAQ;YACV,SAAS,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK;QAC3C;QAEA,MAAM,WAA2C;YAC/C,SAAS;YACT,MAAM;gBACJ;gBACA,OAAO,OAAO,MAAM;YACtB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,MAAM,WAA+B;YACnC,SAAS;YACT,OAAO;QACT;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD;AACF;AAKO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,iBAAiB;QACjB,MAAM,aAAa,kBAAkB,SAAS,CAAC;QAC/C,IAAI,CAAC,WAAW,OAAO,EAAE;YACvB,MAAM,WAA+B;gBACnC,SAAS;gBACT,OAAO,oBAAoB,WAAW,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,OAAO,EAAE,IAAI,CAAC;YAC9E;YACA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;gBAAE,QAAQ;YAAI;QACnD;QAEA,MAAM,QAA0B,WAAW,IAAI;QAC/C,MAAM,QAAQ,kIAAY,CAAC,MAAM,CAAC;YAChC,GAAG,KAAK;YACR,IAAI,IAAA,mLAAM;QACZ;QAEA,MAAM,WAA+B;YACnC,SAAS;YACT,MAAM;YACN,SAAS;QACX;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,WAA+B;YACnC,SAAS;YACT,OAAO;QACT;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD;AACF"}}]
}